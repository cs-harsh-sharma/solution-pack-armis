{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Scenario - Create Armis Alert",
    "aliasName": null,
    "tag": null,
    "description": "Playbook generated sample CVEs, ICS Advisory, KEV Alert and Alert to understand Armis Use Case.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/3bb4552c-051e-43ac-80cd-d7f2c021f1f7",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/4b2f8824-26e7-411f-900f-2e93d6e853e7",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "@id": "{{vars.recordIRI}}"
            },
            "status": null,
            "top": "1240",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2e18fdf1-e469-41e5-83a2-38568ab22ff6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "20",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "4b2f8824-26e7-411f-900f-2e93d6e853e7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get JSON Data",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "name",
                            "value": "Armis - Sample CVEs, ICS Advisory, KEV Alert And Alert",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ]
                },
                "module": "attachments?$limit=30",
                "step_variables": []
            },
            "status": null,
            "top": "160",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "4e25bd27-2fee-48fe-9f74-7a9679bd10d5"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create ICS Advisory Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.iCSAdvisoryData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "year": "{{vars.item.year}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "vendor": "{{vars.item.vendor}}",
                    "iCSAUrl": "{{vars.item.iCSAUrl}}",
                    "product": "{{vars.item.product}}",
                    "__replace": "false",
                    "iCSCERTID": "{{vars.item.iCSCERTID}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "lastUpdated": "{{vars.item.lastUpdated}}",
                    "cVSSSeverity": "{{vars.item.cVSSSeverity['@id']}}",
                    "iCSCERTTitle": "{{vars.item.iCSCERTTitle}}",
                    "cumulativeCVSS": "{{vars.item.cumulativeCVSS}}",
                    "affectedProducts": "{{vars.item.affectedProducts}}",
                    "companyHeadquarters": "{{vars.item.companyHeadquarters}}",
                    "originalReleaseDate": "{{vars.item.originalReleaseDate}}",
                    "countriesAreasDeployed": "{{vars.item.countriesAreasDeployed}}",
                    "criticalInfrastructureSector": "{{vars.item.criticalInfrastructureSector}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/i_c_s_advisories",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_ICS_Advisory_Record | json_query('[*][\"@id\"][]'))}}",
                    "cVEiCSAdvisoryDict": "{% set output = {} %}\n{% for data in vars.cVE %}\n{% set iri = data['@id'] %}\n{% set _ = output.update({iri: []}) %}\n{% for item in vars.steps.Create_ICS_Advisory_Record %}\n{% if data.cVEID in item.cVEID %}\n{% set _ = output[iri].append(item['@id']) %}\n{% endif %}\n{% endfor %}\n{% endfor %}\n{{output}}"
                }
            },
            "status": null,
            "top": "700",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "5de6896d-723a-4d81-89f1-af68d517fa03"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create KEV Alerts",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.kEVAlertData}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "kEVRecord": "{{vars.item}}",
                    "iCSAdvisoryIRI": "{% set output = vars.steps.Create_ICS_Advisory_Record | json_query(\"[?iCSCERTID == '\"+vars.item.iCSID+\"']\") %}{{output | json_query('[*][\"@id\"][]')}}"
                },
                "apply_async": false,
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_KEV_Alerts | json_query('[*][\"kevIRI\"][]'))}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/f107d150-5a29-4750-9008-51280739e6fc"
            },
            "status": null,
            "top": "980",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "6141d610-530d-4e4f-9cd5-18919e669691"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create CVEs Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVEData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "sSVC": "{{vars.item.sSVC}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "cVEURL": "{{vars.item.cVEURL}}",
                    "cVSSv2": "{{vars.item.cVSSv2}}",
                    "cVSSv3": "{{vars.item.cVSSv3}}",
                    "__replace": "false",
                    "reference": "{{vars.item.reference}}",
                    "cPEsDetail": "{{vars.item.cPEsDetail}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "description": "{{vars.item.description}}",
                    "kEVTagSource": "{{vars.item.kEVTagSource['@id']}}",
                    "publishedDate": "{{vars.item.publishedDate}}",
                    "isInKEVCatalog": "{{vars.item.isInKEVCatalog['@id']}}",
                    "lastModifiedOn": "{{vars.item.lastModifiedOn}}",
                    "evaluatorImpact": "{{vars.item.evaluatorImpact}}",
                    "identifierSource": "{{vars.item.identifierSource}}",
                    "vendorStatements": "{{vars.item.vendorStatementsisInKEVCatalog}}",
                    "evaluatorSolution": "{{vars.item.evaluatorImpact}}",
                    "vulnerabilityScore": "<p>{{vars.item.vulnerabilityScore}}<\/p>",
                    "vulnerabilityStatus": "{{vars.item.vulnerabilityStatus['@id']}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/c_v_es",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "cVE": "{{vars.steps.Create_CVEs_Record | flatten}}",
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_CVEs_Record | flatten | json_query('[*][\"@id\"][]'))}}"
                }
            },
            "status": null,
            "top": "560",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "be72719d-7860-4d3e-9b50-c0ed81e29493"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVEs With ICS Advisory",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVE}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "__link": {
                        "recordTags": [],
                        "iCSAdvisories": "{{vars.cVEiCSAdvisoryDict[vars.item[\"@id\"]]}}"
                    }
                },
                "operation": "Append",
                "collection": "{{vars.item[\"@id\"]}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "c9bc39dc-d529-47fa-9eb2-6029f51c24a8"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "cVEData": "{{vars.extractedText['cVEData']}}",
                "recordIRI": "[]",
                "sSVCSchema": "{\n  \"Exploitation\": \"\",\n  \"Technical Impact\": \"\",\n  \"Automatable\": \"\",\n  \"Mission Prevalence\": \"\",\n  \"Well Being\": \"\",\n  \"Mitigation Status\": \"\",\n  \"Automatable Reason\": \"\"\n}",
                "sourceData": "{\n    \"activityUUIDs\": [\n        \"-N3mVocBAAAAAFMnS7Tz\"\n    ],\n    \"alertId\": 15,\n    \"connectionIds\": [],\n    \"description\": \"The Armis security platform has detected a violation of a policy and generated an alert.\",\n    \"deviceIds\": [\n        147\n    ],\n    \"severity\": \"High\",\n    \"status\": \"Unhandled\",\n    \"time\": \"2023-04-06T19:02:25.305173+00:00\",\n    \"title\": \"[Threat] Ransomware Communication Detected\",\n    \"type\": \"System Policy Violation\"\n}",
                "kEVAlertData": "{{vars.extractedText['kEVAlertData']}}",
                "iCSAdvisoryData": "{{vars.extractedText['iCSAdvisoryData']}}"
            },
            "status": null,
            "top": "440",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "cbbd819b-69fe-463d-a5e1-4374080f2ecd"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Artifacts",
            "description": null,
            "arguments": {
                "name": "File Content Extraction",
                "config": "70616ece-f92a-459b-88e5-cbf1b07b37b2",
                "params": {
                    "file_iri": "{{vars.steps.Get_JSON_Data[0].file['@id']}}",
                    "html_output_format": false
                },
                "version": "1.0.3",
                "connector": "file-content-extraction",
                "operation": "extract_text",
                "operationTitle": "Extract Text",
                "pickFromTenant": false,
                "step_variables": {
                    "extractedText": "{{vars.steps.Extract_Artifacts.data['extracted_text']}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "d51caf1e-0912-45fc-86f3-2641f89c8cc1"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Alerts",
            "description": null,
            "arguments": {
                "resource": {
                    "name": "[Threat] Ransomware Communication Detected",
                    "type": "\/api\/3\/picklists\/574a6ee2-7265-4701-815e-cff83b053bce",
                    "state": "\/api\/3\/picklists\/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "source": "Armis",
                    "status": "\/api\/3\/picklists\/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "fsrQueue": "\/api\/3\/fsr_queues\/4cf6073b-319d-4c30-887c-f642adfede82",
                    "severity": "\/api\/3\/picklists\/40187287-89fc-4e9c-b717-e9443d57eedb",
                    "sourceId": "15",
                    "__replace": "",
                    "eventTime": "2023-04-06T19:02:25Z",
                    "recordTags": [
                        "\/api\/3\/tags\/Alerts"
                    ],
                    "sourcedata": "{{vars.sourceData | toJSON}}",
                    "description": "<table border=\\\"1\\\"><thead><tr><th width=\\\"250\\\">Fields<\/th><th width=\\\"250\\\">Values<\/th><\/tr><\/thead>\n<tbody>\n<tr><td>Description<\/td>\n<td>The Armis security platform has detected a violation of a policy and generated an alert.<\/td><\/tr>\n<td>Risk<\/td>\n<td>High<\/td><\/tr>\n<\/tbody>\n<\/table>\n",
                    "ackSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "respSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "priorityWeight": 1,
                    "escalatedtoincident": "\/api\/3\/picklists\/2128a09c-153d-4db3-985d-de6be33deae5",
                    "resolvedAutomatedly": false,
                    "alertRemainingAckSLA": 0
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/alerts",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.append(vars.steps.Create_Alerts['@id'])}}"
                }
            },
            "status": null,
            "top": "1100",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "f3004a79-dab7-4705-8372-6d5d8daf8c9f"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Extract Artifacts -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/cbbd819b-69fe-463d-a5e1-4374080f2ecd",
            "sourceStep": "\/api\/3\/workflow_steps\/d51caf1e-0912-45fc-86f3-2641f89c8cc1",
            "label": null,
            "isExecuted": false,
            "uuid": "103f97e3-f589-481a-89fd-eb5dedc6239d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create CVEs Record -> Create ICS Advisory Record",
            "targetStep": "\/api\/3\/workflow_steps\/5de6896d-723a-4d81-89f1-af68d517fa03",
            "sourceStep": "\/api\/3\/workflow_steps\/be72719d-7860-4d3e-9b50-c0ed81e29493",
            "label": null,
            "isExecuted": false,
            "uuid": "2d83cccf-56ab-4df9-ad78-bc6192b88fd1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get JSON Data",
            "targetStep": "\/api\/3\/workflow_steps\/4e25bd27-2fee-48fe-9f74-7a9679bd10d5",
            "sourceStep": "\/api\/3\/workflow_steps\/4b2f8824-26e7-411f-900f-2e93d6e853e7",
            "label": null,
            "isExecuted": false,
            "uuid": "639a76af-ff91-41d3-a5b4-2e4e724a19a4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Alerts -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/2e18fdf1-e469-41e5-83a2-38568ab22ff6",
            "sourceStep": "\/api\/3\/workflow_steps\/f3004a79-dab7-4705-8372-6d5d8daf8c9f",
            "label": null,
            "isExecuted": false,
            "uuid": "6972d14e-d206-4e63-9881-d0e1fb31927c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVEs With ICS Advisory -> Create KEV Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/6141d610-530d-4e4f-9cd5-18919e669691",
            "sourceStep": "\/api\/3\/workflow_steps\/c9bc39dc-d529-47fa-9eb2-6029f51c24a8",
            "label": null,
            "isExecuted": false,
            "uuid": "b31b0918-da04-4800-8ab2-c45d5ba70df3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create ICS Advisory Record -> Update CVEs With ICS Advisory",
            "targetStep": "\/api\/3\/workflow_steps\/c9bc39dc-d529-47fa-9eb2-6029f51c24a8",
            "sourceStep": "\/api\/3\/workflow_steps\/5de6896d-723a-4d81-89f1-af68d517fa03",
            "label": null,
            "isExecuted": false,
            "uuid": "e08b415e-ac3e-43fb-8e6b-eb029adb3734"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create KEV Alerts -> Create Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/f3004a79-dab7-4705-8372-6d5d8daf8c9f",
            "sourceStep": "\/api\/3\/workflow_steps\/6141d610-530d-4e4f-9cd5-18919e669691",
            "label": null,
            "isExecuted": false,
            "uuid": "eb87ec45-358b-4c0e-a800-f93fea7c0c44"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get JSON Data -> Extract Artifacts",
            "targetStep": "\/api\/3\/workflow_steps\/d51caf1e-0912-45fc-86f3-2641f89c8cc1",
            "sourceStep": "\/api\/3\/workflow_steps\/4e25bd27-2fee-48fe-9f74-7a9679bd10d5",
            "label": null,
            "isExecuted": false,
            "uuid": "f10bcf12-db22-45d8-90d7-aa42b1fb7143"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Create CVEs Record",
            "targetStep": "\/api\/3\/workflow_steps\/be72719d-7860-4d3e-9b50-c0ed81e29493",
            "sourceStep": "\/api\/3\/workflow_steps\/cbbd819b-69fe-463d-a5e1-4374080f2ecd",
            "label": null,
            "isExecuted": false,
            "uuid": "f11cc978-7d0a-4205-9279-32b48959a675"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "e3840d65-6010-4959-b89e-a8007e35fae6",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alert",
        "Scenario",
        "OT IT",
        "KEV",
        "CVE",
        "ICS Advisory",
        "Armis"
    ]
}