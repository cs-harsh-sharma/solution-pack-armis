{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Scenario - Create Armis Alert",
    "aliasName": null,
    "tag": null,
    "description": "Playbook generated sample CVEs, ICS Advisory, KEV Alert and Alert to understand Armis Use Case.",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/3bb4552c-051e-43ac-80cd-d7f2c021f1f7",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/4b2f8824-26e7-411f-900f-2e93d6e853e7",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "@id": "{{vars.recordIRI}}"
            },
            "status": null,
            "top": "560",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2e18fdf1-e469-41e5-83a2-38568ab22ff6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "0",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "4b2f8824-26e7-411f-900f-2e93d6e853e7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create ICS Advisory Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.ics_advisory}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "year": "{{vars.item.year}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "vendor": "{{vars.item.vendor}}",
                    "iCSAUrl": "{{vars.item.iCSAUrl}}",
                    "product": "{{vars.item.product}}",
                    "__replace": "false",
                    "iCSCERTID": "{{vars.item.iCSCERTID}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "lastUpdated": "{{vars.item.lastUpdated}}",
                    "cVSSSeverity": "{{vars.item.cVSSSeverity['@id']}}",
                    "iCSCERTTitle": "{{vars.item.iCSCERTTitle}}",
                    "cumulativeCVSS": "{{vars.item.cumulativeCVSS}}",
                    "affectedProducts": "{{vars.item.affectedProducts}}",
                    "companyHeadquarters": "{{vars.item.companyHeadquarters}}",
                    "originalReleaseDate": "{{vars.item.originalReleaseDate}}",
                    "countriesAreasDeployed": "{{vars.item.countriesAreasDeployed}}",
                    "criticalInfrastructureSector": "{{vars.item.criticalInfrastructureSector}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/i_c_s_advisories",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_ICS_Advisory_Record | json_query('[*][\"@id\"][]'))}}",
                    "cVEiCSAdvisoryDict": "{% set output = {} %}\n{% for data in vars.cVE %}\n{% set iri = data['@id'] %}\n{% set _ = output.update({iri: []}) %}\n{% for item in vars.steps.Create_ICS_Advisory_Record %}\n{% if data.cVEID in item.cVEID %}\n{% set _ = output[iri].append(item['@id']) %}\n{% endif %}\n{% endfor %}\n{% endfor %}\n{{output}}"
                }
            },
            "status": null,
            "top": "420",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "5de6896d-723a-4d81-89f1-af68d517fa03"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create KEV Alerts",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.kEVAlertData}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "kEVRecord": "{{vars.item}}",
                    "iCSAdvisoryIRI": "{% set output = vars.steps.Create_ICS_Advisory_Record | json_query(\"[?iCSCERTID == '\"+vars.item.iCSID+\"']\") %}{{output | json_query('[*][\"@id\"][]')}}"
                },
                "apply_async": false,
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_KEV_Alerts | json_query('[*][\"kevIRI\"][]'))}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/f107d150-5a29-4750-9008-51280739e6fc"
            },
            "status": null,
            "top": "400",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "6141d610-530d-4e4f-9cd5-18919e669691"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create CVEs Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVEData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "sSVC": "{{vars.item.sSVC}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "cVEURL": "{{vars.item.cVEURL}}",
                    "cVSSv2": "{{vars.item.cVSSv2}}",
                    "cVSSv3": "{{vars.item.cVSSv3}}",
                    "__replace": "false",
                    "reference": "{{vars.item.reference}}",
                    "cPEsDetail": "{{vars.item.cPEsDetail}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "description": "{{vars.item.description}}",
                    "kEVTagSource": "{{vars.item.kEVTagSource['@id']}}",
                    "publishedDate": "{{vars.item.publishedDate}}",
                    "isInKEVCatalog": "{{vars.item.isInKEVCatalog['@id']}}",
                    "lastModifiedOn": "{{vars.item.lastModifiedOn}}",
                    "evaluatorImpact": "{{vars.item.evaluatorImpact}}",
                    "identifierSource": "{{vars.item.identifierSource}}",
                    "vendorStatements": "{{vars.item.vendorStatementsisInKEVCatalog}}",
                    "evaluatorSolution": "{{vars.item.evaluatorImpact}}",
                    "vulnerabilityScore": "<p>{{vars.item.vulnerabilityScore}}<\/p>",
                    "vulnerabilityStatus": "{{vars.item.vulnerabilityStatus['@id']}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/c_v_es",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "cVE": "{{vars.steps.Create_CVEs_Record | flatten}}",
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_CVEs_Record | flatten | json_query('[*][\"@id\"][]'))}}"
                }
            },
            "status": null,
            "top": "120",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "be72719d-7860-4d3e-9b50-c0ed81e29493"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVEs With ICS Advisory",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVE}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "__link": {
                        "recordTags": [],
                        "iCSAdvisories": "{{vars.cVEiCSAdvisoryDict[vars.item[\"@id\"]]}}"
                    }
                },
                "operation": "Append",
                "collection": "{{vars.item[\"@id\"]}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "260",
            "left": "960",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "c9bc39dc-d529-47fa-9eb2-6029f51c24a8"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "recordIRI": "[]",
                "sSVCSchema": "{\n  \"Exploitation\": \"\",\n  \"Technical Impact\": \"\",\n  \"Automatable\": \"\",\n  \"Mission Prevalence\": \"\",\n  \"Well Being\": \"\",\n  \"Mitigation Status\": \"\",\n  \"Automatable Reason\": \"\"\n}",
                "sourceData": "{\n    \"activityUUIDs\": [\n        \"V9_mVocBAAAAAFMnewp_\",\n        \"Wt_mVocBAAAAAFMnewp_\"\n    ],\n    \"alertId\": 193,\n    \"connectionIds\": [],\n    \"description\": \"The Armis security platform has detected a violation of a policy and generated an alert.\",\n    \"deviceIds\": [\n        3225,\n        2151\n    ],\n    \"severity\": \"Medium\",\n    \"status\": \"Unhandled\",\n    \"time\": \"2023-04-05T20:39:25.336869+00:00\",\n    \"title\": \"[Suspicious\/OT] PLC Hardware Change\",\n    \"type\": \"System Policy Violation\"\n}",
                "ics_advisory": "{\n  \"year\": \"2017\",\n  \"cVEID\": \"CVE-2017-6736, CVE-2017-6737, CVE-2017-6738, CVE-2017-6739, CVE-2017-6740, CVE-2017-6741, CVE-2017-6742, CVE-2017-6743, CVE-2017-6744\",\n  \"cWEID\": \"CWE-119\",\n  \"isKEV\": {\n    \"id\": 369,\n    \"@id\": \"\/api\/3\/picklists\/cfd49634-d25a-476f-8485-99585e589a8c\",\n    \"icon\": null,\n    \"uuid\": \"cfd49634-d25a-476f-8485-99585e589a8c\",\n    \"@type\": \"Picklist\",\n    \"color\": null,\n    \"listName\": \"\/api\/3\/picklist_names\/7b348719-8ffc-4c94-8ce7-1812eae43d78\",\n    \"itemValue\": \"Yes\",\n    \"importedBy\": [],\n    \"orderIndex\": 0\n  },\n  \"vendor\": \"Rockwell Automation\",\n  \"iCSAUrl\": \"https:\/\/us-cert.cisa.gov\/\/ics\/advisories\/icsa-17-208-04\",\n  \"product\": \"Allen-Bradley Stratix and ArmorStratix\",\n  \"assignee\": \"\",\n  \"iCSCERTID\": \"ICSA-17-208-04\",\n  \"recordTags\": [\n    \"Critical Manufacturing\",\n    \" Energy\",\n    \"KEV\",\n    \"Rockwell Automation\",\n    \" Water and Wastewater\"\n  ],\n  \"lastUpdated\": 1503878400,\n  \"cVSSSeverity\": {\n    \"id\": 358,\n    \"@id\": \"\/api\/3\/picklists\/40187287-89fc-4e9c-b717-e9443d57eedb\",\n    \"icon\": null,\n    \"uuid\": \"40187287-89fc-4e9c-b717-e9443d57eedb\",\n    \"@type\": \"Picklist\",\n    \"color\": \"#DE7A13\",\n    \"listName\": \"\/api\/3\/picklist_names\/4e80cba3-032f-48b4-ac03-17e3ec247aac\",\n    \"itemValue\": \"High\",\n    \"importedBy\": [],\n    \"orderIndex\": 3\n  },\n  \"iCSCERTTitle\": \"Rockwell Automation Allen-Bradley Stratix and ArmorStratix\",\n  \"cumulativeCVSS\": 8.8,\n  \"affectedProducts\": \"The following versions of Allen-Bradley Stratix and ArmorStratix switches are affected: All Versions 15.2(5)EA.fc4 and earlierAllen-Bradley Stratix 5400 Industrial Ethernet SwitchesAllen-Bradley Stratix 5410 Industrial Distribution SwitchesAllen-Bradley Stratix 5700 and ArmorStratix\u2122 5700 Industrial Managed Ethernet SwitchesAllen-Bradley Stratix 8000 Modular Managed Ethernet SwitchesAll Versions 15.6(3)M1 and earlierAllen-Bradley Stratix 5900 Services RouterAll Versions 15.2(4)EA and earlierStratix 8300 Modular Managed Ethernet Switches\",\n  \"companyHeadquarters\": \"United States\",\n  \"originalReleaseDate\": 1503532800,\n  \"countriesAreasDeployed\": \"Worldwide\",\n  \"criticalInfrastructureSector\": \"Critical Manufacturing; Energy; Water and Wastewater\"\n}"
            },
            "status": null,
            "top": "140",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "cbbd819b-69fe-463d-a5e1-4374080f2ecd"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Alerts",
            "description": null,
            "arguments": {
                "resource": {
                    "name": "[Suspicious\/OT] PLC Hardware Change",
                    "type": "\/api\/3\/picklists\/574a6ee2-7265-4701-815e-cff83b053bce",
                    "state": "\/api\/3\/picklists\/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "source": "Armis",
                    "status": "\/api\/3\/picklists\/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "fsrQueue": "\/api\/3\/fsr_queues\/4cf6073b-319d-4c30-887c-f642adfede82",
                    "severity": "\/api\/3\/picklists\/b3c20a3a-ecfd-4adc-a225-0205968e6793",
                    "sourceId": "193",
                    "__replace": "",
                    "eventTime": "2023-04-05T20:39:25Z",
                    "recordTags": [
                        "\/api\/3\/tags\/Alerts"
                    ],
                    "sourcedata": "{{vars.sourceData | toJSON}}",
                    "description": "<table border=\\\"1\\\"><thead><tr><th width=\\\"250\\\">Fields<\/th><th width=\\\"250\\\">Values<\/th><\/tr><\/thead>\n<tbody>\n<tr>\n<td>Description<\/td>\n<td>The Armis security platform has detected a violation of a policy and generated an alert.<\/td>\n<\/tr>\n<tr>\n<td>Risk<\/td>\n<td>Medium<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n",
                    "ackSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "respSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "priorityWeight": 1,
                    "escalatedtoincident": "\/api\/3\/picklists\/2128a09c-153d-4db3-985d-de6be33deae5",
                    "resolvedAutomatedly": false,
                    "alertRemainingAckSLA": 0
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/alerts",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.append(vars.steps.Create_Alerts['@id'])}}"
                }
            },
            "status": null,
            "top": "280",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "f3004a79-dab7-4705-8372-6d5d8daf8c9f"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/cbbd819b-69fe-463d-a5e1-4374080f2ecd",
            "sourceStep": "\/api\/3\/workflow_steps\/4b2f8824-26e7-411f-900f-2e93d6e853e7",
            "label": null,
            "isExecuted": false,
            "uuid": "01510581-8345-4cd3-961e-d4596f87fb3d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create CVEs Record -> Update CVEs With ICS Advisory",
            "targetStep": "\/api\/3\/workflow_steps\/c9bc39dc-d529-47fa-9eb2-6029f51c24a8",
            "sourceStep": "\/api\/3\/workflow_steps\/be72719d-7860-4d3e-9b50-c0ed81e29493",
            "label": null,
            "isExecuted": false,
            "uuid": "0665778d-7934-41d8-bdac-e00b7995166f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Create Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/f3004a79-dab7-4705-8372-6d5d8daf8c9f",
            "sourceStep": "\/api\/3\/workflow_steps\/cbbd819b-69fe-463d-a5e1-4374080f2ecd",
            "label": null,
            "isExecuted": false,
            "uuid": "17946258-e455-432d-ab3c-e7004bc9b88b"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create ICS Advisory Record -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/2e18fdf1-e469-41e5-83a2-38568ab22ff6",
            "sourceStep": "\/api\/3\/workflow_steps\/5de6896d-723a-4d81-89f1-af68d517fa03",
            "label": null,
            "isExecuted": false,
            "uuid": "543202cd-7324-43f4-a54b-1a8aae941d29"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Alerts -> Create ICS Advisory Record",
            "targetStep": "\/api\/3\/workflow_steps\/5de6896d-723a-4d81-89f1-af68d517fa03",
            "sourceStep": "\/api\/3\/workflow_steps\/f3004a79-dab7-4705-8372-6d5d8daf8c9f",
            "label": null,
            "isExecuted": false,
            "uuid": "6aecbbb2-6fa0-4da9-a45b-8ac9432ea641"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVEs With ICS Advisory -> Create KEV Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/6141d610-530d-4e4f-9cd5-18919e669691",
            "sourceStep": "\/api\/3\/workflow_steps\/c9bc39dc-d529-47fa-9eb2-6029f51c24a8",
            "label": null,
            "isExecuted": false,
            "uuid": "b31b0918-da04-4800-8ab2-c45d5ba70df3"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "e3840d65-6010-4959-b89e-a8007e35fae6",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alert",
        "Armis",
        "CVE",
        "OT IT",
        "Scenario"
    ]
}