{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Get And Update CVE",
    "aliasName": null,
    "tag": null,
    "description": "This PB will get CVE report from NIST-NVD and will update CVE record.",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "CVERecord"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/3bb4552c-051e-43ac-80cd-d7f2c021f1f7",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/aaf72741-19f7-412a-aee8-723c9db374d9",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "results": "{% set output = ({\"uuid\":vars.record['uuid'], \"cVEId\":vars.record['cVEID']}) %}{% if vars.CVEData | length > 0 %}{% set _ = output.update({\"status\": \"Found\"}) %}{% else %}{% set _ = output.update({\"status\": \"Not Found\"}) %}{% endif %}{{output}}"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "56dd9f47-6215-4074-b77b-beaf0f37285c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CVE by ID",
            "description": null,
            "arguments": {
                "name": "NIST National Vulnerability Database",
                "config": "09666536-d2b4-4833-adf3-5df2d57b8e2b",
                "params": {
                    "cveId": "{{vars.record['cVEID']}}"
                },
                "version": "1.0.1",
                "connector": "nist-nvd",
                "operation": "get_specific_cve_details",
                "ignore_errors": false,
                "operationTitle": "Get Specific CVE ID Details",
                "pickFromTenant": false,
                "step_variables": {
                    "CVEData": "{{vars.result.data.vulnerabilities}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "683e308b-292c-4759-bc31-d32c4bee7553"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVE",
            "description": null,
            "arguments": {
                "when": "{{vars.CVEData | length > 0}}",
                "resource": {
                    "cWEID": "{% if vars.CVEData[0].cve.get(\"weaknesses\", \"\") != \"\" %}{% set cwe = vars.CVEData[0].cve['weaknesses'] | json_query(\"[*][description][][][value][]\") | unique %}{{cwe | join(', ')}}{% endif %}",
                    "__link": {
                        "recordTags": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"KEV\"}}{% endif %}"
                    },
                    "cVEURL": "https:\/\/nvd.nist.gov\/vuln\/detail\/{{vars.CVEData[0].cve['id']}}",
                    "cVSSv2": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV2'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['metrics']['cvssMetricV2'] %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "cVSSv3": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n{% set  version = (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.metrics.get(version) %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.cvssData.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "reference": "{% if vars.CVEData[0].cve['references'] %}\n| Hyperlink | Tags | Source |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['references'] %}\n| <a href=\"{{item.url}}\">{{item.url}}<\/a> | {{item.tags | join(', ')}} | {{item.source}} |{% endfor %}{% endif %}",
                    "cPEsDetail": "{% if vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| CPE Name | Is Vulnerable | Match Id |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| {{item.criteria}} | {{item.vulnerable}} | {{item.matchCriteriaId}} |{% endfor %}{% endif %}",
                    "sourceData": "{{vars.CVEData[0].cve | toJSON }}",
                    "description": "{{(vars.CVEData[0].cve.descriptions  | json_query(\"[?lang == 'en'].value\"))[0] }}",
                    "kEVTagSource": "\/api\/3\/picklists\/b5492d79-fe49-43ab-9786-f8e60fc12204",
                    "publishedDate": "{{arrow.get(vars.CVEData[0].cve['published']).int_timestamp}}",
                    "isInKEVCatalog": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"YesNoInput\" | picklist(\"Yes\", \"@id\")}}{% else %}{{\"YesNoInput\" | picklist(\"No\", \"@id\")}}{% endif %}",
                    "lastModifiedOn": "{{arrow.get(vars.CVEData[0].cve['lastModified']).int_timestamp}}",
                    "evaluatorImpact": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "identifierSource": "{{vars.CVEData[0].cve.sourceIdentifier}}",
                    "vendorStatements": "{% if 'vendorComments' in vars.CVEData[0].cve %}\n[Vendor Statements](https:\/\/nvd.nist.gov\/vuln\/vendor-comments)\n\n{% for item in vars.CVEData[0].cve['vendorComments'] %}\n<p><h5>{{item.organization}} ({{item.lastModified.split('T')[0] }}) <\/h5>&emsp;{{item.comment}}<\/p>\n{% endfor %}\n{% endif %}\n",
                    "evaluatorSolution": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "vulnerabilityStatus": "{{\"CVEVulnerabilityStatus\" | picklist(vars.CVEData[0].cve['vulnStatus'], \"@id\")}}"
                },
                "operation": "Append",
                "collection": "{{vars.record['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "aad78126-fe8f-4485-a083-c9732110b7e7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "aaf72741-19f7-412a-aee8-723c9db374d9"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "record": "{{vars.input.params.CVERecord}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "be83d5a0-298c-4ae7-911c-826e169c4a82"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Get CVE by ID -> Update CVE",
            "targetStep": "\/api\/3\/workflow_steps\/aad78126-fe8f-4485-a083-c9732110b7e7",
            "sourceStep": "\/api\/3\/workflow_steps\/683e308b-292c-4759-bc31-d32c4bee7553",
            "label": null,
            "isExecuted": false,
            "uuid": "15a40aee-25f1-4ba4-91f6-dd229caa31c8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get CVE by ID",
            "targetStep": "\/api\/3\/workflow_steps\/683e308b-292c-4759-bc31-d32c4bee7553",
            "sourceStep": "\/api\/3\/workflow_steps\/be83d5a0-298c-4ae7-911c-826e169c4a82",
            "label": null,
            "isExecuted": false,
            "uuid": "37a86008-3deb-4f8b-9493-3269d44eed88"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVE -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/56dd9f47-6215-4074-b77b-beaf0f37285c",
            "sourceStep": "\/api\/3\/workflow_steps\/aad78126-fe8f-4485-a083-c9732110b7e7",
            "label": null,
            "isExecuted": false,
            "uuid": "5721d64d-56c2-4fee-95e1-dd295696acec"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/be83d5a0-298c-4ae7-911c-826e169c4a82",
            "sourceStep": "\/api\/3\/workflow_steps\/aaf72741-19f7-412a-aee8-723c9db374d9",
            "label": null,
            "isExecuted": false,
            "uuid": "80b64caa-7948-465f-b56f-fc0f997a021c"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "efea3161-a3fa-48a8-a239-1e782f8c9ec7",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alert",
        "CVE",
        "KEV",
        "OT IT",
        "Referenced",
        "Update"
    ]
}